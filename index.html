<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Un Encuentro con Dios - Inscripci√≥n</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-100 min-h-screen p-4">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
            <!-- Header -->
            <div class="bg-gradient-to-r from-purple-600 to-indigo-600 p-6 text-white">
                <h1 class="text-3xl font-bold text-center mb-2">Un Encuentro con Dios</h1>
                <p class="text-center text-purple-100 text-lg">Retiro Espiritual</p>
                <p class="text-center text-purple-200 mt-2">üìÖ 2 de Noviembre, 2025 ‚Ä¢ üìç Mar√≠a Grande</p>
            </div>

            <!-- Navegaci√≥n -->
            <div class="flex border-b" id="nav-tabs">
                <button onclick="mostrarVista('formulario')" id="tab-formulario" class="flex-1 py-4 px-6 font-semibold transition-colors bg-purple-50 text-purple-700 border-b-2 border-purple-600">
                    Formulario
                </button>
                <button onclick="mostrarVista('admin')" id="tab-admin" class="flex-1 py-4 px-6 font-semibold transition-colors text-gray-600 hover:bg-gray-50">
                    Administrador
                </button>
            </div>

            <!-- Contenido -->
            <div class="p-6">
                <!-- Vista Formulario -->
                <div id="vista-formulario">
                    <div class="max-w-2xl mx-auto">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">Inscripci√≥n al Retiro</h2>
                        <p class="text-gray-600 mb-6">Completa tus datos para confirmar tu participaci√≥n en "Un Encuentro con Dios"</p>
                        
                        <div id="mensaje-form" class="mb-6 p-4 rounded-lg hidden"></div>

                        <div class="space-y-5">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nombre *</label>
                                    <input type="text" id="nombre" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition" placeholder="Tu nombre">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Apellido *</label>
                                    <input type="text" id="apellido" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition" placeholder="Tu apellido">
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Edad *</label>
                                    <input type="number" id="edad" min="1" max="120" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition" placeholder="Tu edad">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Ciudad *</label>
                                    <select id="ciudad" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition bg-white">
                                        <option value="">Selecciona tu ciudad</option>
                                        <option value="Mar√≠a Grande">Mar√≠a Grande</option>
                                        <option value="El Pingo">El Pingo</option>
                                        <option value="Est. Sosa">Est. Sosa</option>
                                        <option value="Tabossi">Tabossi</option>
                                        <option value="Otras">Otras</option>
                                    </select>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Tel√©fono de Contacto *</label>
                                <input type="tel" id="telefono" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition" placeholder="+54 9 343 123-4567">
                            </div>

                            <button onclick="inscribir()" class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-4 rounded-lg font-bold text-lg hover:from-purple-700 hover:to-indigo-700 transition-all shadow-lg hover:shadow-xl">
                                Confirmar Inscripci√≥n
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Vista Admin Login -->
                <div id="vista-admin" class="hidden">
                    <div class="max-w-md mx-auto">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Acceso Administrador</h2>
                        
                        <div id="mensaje-admin" class="mb-6 p-4 rounded-lg text-center hidden"></div>

                        <div class="bg-purple-50 p-6 rounded-xl">
                            <label class="block text-sm font-semibold text-gray-700 mb-3">Ingresa la clave de administrador:</label>
                            <input type="password" id="clave-admin" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition mb-4" placeholder="Clave de acceso" onkeypress="if(event.key==='Enter') verificarClave()">
                            <button onclick="verificarClave()" class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-3 rounded-lg font-bold hover:from-purple-700 hover:to-indigo-700 transition-all">
                                Ingresar
                            </button>
                        </div>

                        <div class="mt-6 p-4 bg-blue-50 rounded-lg text-sm text-blue-700">
                            <p class="font-semibold mb-1">‚ÑπÔ∏è Informaci√≥n</p>
                            <p>Solo los administradores pueden ver el listado de inscriptos y el c√≥digo QR.</p>
                        </div>
                    </div>
                </div>

                <!-- Vista Inscriptos (Admin) -->
                <div id="vista-inscriptos" class="hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Lista de Inscriptos (<span id="contador-inscriptos">0</span>)</h2>
                        <div class="flex gap-3">
                            <button onclick="exportarCSV()" class="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
                                Exportar CSV
                            </button>
                            <button onclick="cerrarSesion()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition">
                                Cerrar Sesi√≥n
                            </button>
                        </div>
                    </div>

                    <div id="tabla-inscriptos"></div>
                </div>

                <!-- Vista QR (Admin) -->
                <div id="vista-qr" class="hidden">
                    <div class="max-w-md mx-auto text-center">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-800">C√≥digo QR de Inscripci√≥n</h2>
                            <button onclick="cerrarSesion()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition text-sm">
                                Cerrar Sesi√≥n
                            </button>
                        </div>
                        <p class="text-gray-600 mb-6">Comparte este c√≥digo QR para que las personas puedan inscribirse f√°cilmente al retiro "Un Encuentro con Dios"</p>
                        
                        <div class="bg-white p-6 rounded-xl shadow-lg inline-block mb-6">
                            <img id="img-qr" src="" alt="C√≥digo QR de inscripci√≥n" class="w-64 h-64">
                        </div>

                        <a id="descargar-qr" download="qr-inscripcion-retiro.png" class="inline-flex items-center gap-2 bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition font-semibold cursor-pointer">
                            Descargar C√≥digo QR
                        </a>

                        <div class="mt-8 p-4 bg-blue-50 rounded-lg text-left">
                            <p class="text-sm text-blue-800 font-semibold mb-2">üí° Instrucciones:</p>
                            <ul class="text-sm text-blue-700 space-y-1">
                                <li>‚Ä¢ Descarga el c√≥digo QR</li>
                                <li>‚Ä¢ Impr√≠melo o comp√°rtelo digitalmente</li>
                                <li>‚Ä¢ Las personas pueden escanearlo con su celular</li>
                                <li>‚Ä¢ Ser√°n dirigidos directamente al formulario</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const CLAVE_ADMIN = 'retiro2025';
        const FECHA_RETIRO = new Date('2025-11-02');
        let esAdmin = false;

        // Cargar inscriptos desde localStorage
        function cargarInscriptos() {
            const inscriptos = localStorage.getItem('inscriptos');
            return inscriptos ? JSON.parse(inscriptos) : [];
        }

        // Guardar inscriptos en localStorage
        function guardarInscriptos(inscriptos) {
            localStorage.setItem('inscriptos', JSON.stringify(inscriptos));
        }

        // Mostrar mensaje
        function mostrarMensaje(id, texto, tipo) {
            const elemento = document.getElementById(id);
            elemento.textContent = texto;
            elemento.className = `mb-6 p-4 rounded-lg ${tipo === 'error' ? 'bg-red-50 border border-red-200 text-red-800' : 'bg-green-50 border border-green-200 text-green-800'}`;
            elemento.classList.remove('hidden');
            setTimeout(() => elemento.classList.add('hidden'), 3000);
        }

        // Inscribir
        function inscribir() {
            const nombre = document.getElementById('nombre').value.trim();
            const apellido = document.getElementById('apellido').value.trim();
            const edad = document.getElementById('edad').value.trim();
            const ciudad = document.getElementById('ciudad').value;
            const telefono = document.getElementById('telefono').value.trim();

            if (!nombre || !apellido || !edad || !ciudad || !telefono) {
                mostrarMensaje('mensaje-form', 'Por favor completa todos los campos', 'error');
                return;
            }

            const hoy = new Date();
            if (hoy > FECHA_RETIRO) {
                mostrarMensaje('mensaje-form', 'La fecha del retiro ya ha pasado. No se pueden realizar m√°s inscripciones.', 'error');
                return;
            }

            const inscriptos = cargarInscriptos();
            const nuevoInscripto = {
                id: Date.now(),
                nombre,
                apellido,
                edad,
                ciudad,
                telefono,
                fecha: new Date().toLocaleString('es-AR')
            };

            inscriptos.push(nuevoInscripto);
            guardarInscriptos(inscriptos);

            mostrarMensaje('mensaje-form', '¬°Inscripci√≥n realizada con √©xito!', 'success');
            
            // Limpiar formulario
            document.getElementById('nombre').value = '';
            document.getElementById('apellido').value = '';
            document.getElementById('edad').value = '';
            document.getElementById('ciudad').value = '';
            document.getElementById('telefono').value = '';
        }

        // Verificar clave admin
        function verificarClave() {
            const clave = document.getElementById('clave-admin').value;
            if (clave === CLAVE_ADMIN) {
                esAdmin = true;
                mostrarVistaAdmin();
            } else {
                mostrarMensaje('mensaje-admin', 'Clave incorrecta', 'error');
            }
        }

        // Mostrar vista admin
        function mostrarVistaAdmin() {
            // Ocultar login y mostrar tabs admin
            document.getElementById('vista-admin').classList.add('hidden');
            
            // Agregar tabs de inscriptos y QR
            const navTabs = document.getElementById('nav-tabs');
            if (!document.getElementById('tab-inscriptos')) {
                navTabs.innerHTML = `
                    <button onclick="mostrarVista('formulario')" id="tab-formulario" class="flex-1 py-4 px-6 font-semibold transition-colors text-gray-600 hover:bg-gray-50">Formulario</button>
                    <button onclick="mostrarVista('inscriptos')" id="tab-inscriptos" class="flex-1 py-4 px-6 font-semibold transition-colors bg-purple-50 text-purple-700 border-b-2 border-purple-600">Inscriptos</button>
                    <button onclick="mostrarVista('qr')" id="tab-qr" class="flex-1 py-4 px-6 font-semibold transition-colors text-gray-600 hover:bg-gray-50">C√≥digo QR</button>
                `;
            }
            
            mostrarVista('inscriptos');
        }

        // Mostrar vista
        function mostrarVista(vista) {
            // Ocultar todas las vistas
            document.getElementById('vista-formulario').classList.add('hidden');
            document.getElementById('vista-admin').classList.add('hidden');
            document.getElementById('vista-inscriptos').classList.add('hidden');
            document.getElementById('vista-qr').classList.add('hidden');

            // Actualizar tabs
            document.querySelectorAll('#nav-tabs button').forEach(btn => {
                btn.className = 'flex-1 py-4 px-6 font-semibold transition-colors text-gray-600 hover:bg-gray-50';
            });

            // Mostrar vista seleccionada
            if (vista === 'formulario') {
                document.getElementById('vista-formulario').classList.remove('hidden');
                document.getElementById('tab-formulario')?.classList.add('bg-purple-50', 'text-purple-700', 'border-b-2', 'border-purple-600');
            } else if (vista === 'admin') {
                if (!esAdmin) {
                    document.getElementById('vista-admin').classList.remove('hidden');
                    document.getElementById('tab-admin')?.classList.add('bg-purple-50', 'text-purple-700', 'border-b-2', 'border-purple-600');
                }
            } else if (vista === 'inscriptos' && esAdmin) {
                document.getElementById('vista-inscriptos').classList.remove('hidden');
                document.getElementById('tab-inscriptos')?.classList.add('bg-purple-50', 'text-purple-700', 'border-b-2', 'border-purple-600');
                cargarTablaInscriptos();
            } else if (vista === 'qr' && esAdmin) {
                document.getElementById('vista-qr').classList.remove('hidden');
                document.getElementById('tab-qr')?.classList.add('bg-purple-50', 'text-purple-700', 'border-b-2', 'border-purple-600');
                generarQR();
            }
        }

        // Cargar tabla de inscriptos
        function cargarTablaInscriptos() {
            const inscriptos = cargarInscriptos();
            document.getElementById('contador-inscriptos').textContent = inscriptos.length;

            const tabla = document.getElementById('tabla-inscriptos');
            
            if (inscriptos.length === 0) {
                tabla.innerHTML = '<div class="text-center py-12 text-gray-500"><p class="text-lg">A√∫n no hay inscriptos registrados</p></div>';
                return;
            }

            const hoy = new Date();
            const puedeRevocar = hoy <= FECHA_RETIRO;

            let html = '<div class="overflow-x-auto"><table class="w-full"><thead><tr class="bg-purple-50">';
            html += '<th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Nombre</th>';
            html += '<th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Apellido</th>';
            html += '<th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Edad</th>';
            html += '<th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Ciudad</th>';
            html += '<th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Tel√©fono</th>';
            html += '<th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Fecha</th>';
            if (puedeRevocar) html += '<th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Acciones</th>';
            html += '</tr></thead><tbody>';

            inscriptos.forEach((inscripto, index) => {
                const bgClass = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                html += `<tr class="${bgClass}">`;
                html += `<td class="px-4 py-3 text-sm text-gray-800">${inscripto.nombre}</td>`;
                html += `<td class="px-4 py-3 text-sm text-gray-800">${inscripto.apellido}</td>`;
                html += `<td class="px-4 py-3 text-sm text-gray-800">${inscripto.edad}</td>`;
                html += `<td class="px-4 py-3 text-sm text-gray-800">${inscripto.ciudad}</td>`;
                html += `<td class="px-4 py-3 text-sm text-gray-800">${inscripto.telefono}</td>`;
                html += `<td class="px-4 py-3 text-sm text-gray-600">${inscripto.fecha}</td>`;
                if (puedeRevocar) {
                    html += `<td class="px-4 py-3 text-sm"><button onclick="revocarInscripcion(${inscripto.id})" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition text-xs font-semibold">Revocar</button></td>`;
                }
                html += '</tr>';
            });

            html += '</tbody></table></div>';
            tabla.innerHTML = html;
        }

        // Revocar inscripci√≥n
        function revocarInscripcion(id) {
            if (confirm('¬øEst√°s seguro de que deseas revocar esta inscripci√≥n?')) {
                let inscriptos = cargarInscriptos();
                inscriptos = inscriptos.filter(i => i.id !== id);
                guardarInscriptos(inscriptos);
                cargarTablaInscriptos();
            }
        }

        // Exportar CSV
        function exportarCSV() {
            const inscriptos = cargarInscriptos();
            if (inscriptos.length === 0) return;

            let csv = 'Nombre,Apellido,Edad,Ciudad,Tel√©fono,Fecha de Inscripci√≥n\n';
            inscriptos.forEach(i => {
                csv += `"${i.nombre}","${i.apellido}","${i.edad}","${i.ciudad}","${i.telefono}","${i.fecha}"\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `inscriptos-retiro-${new Date().toLocaleDateString('es-AR')}.csv`;
            link.click();
        }

        // Generar QR
        function generarQR() {
            const url = window.location.href.split('?')[0];
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(url)}`;
            document.getElementById('img-qr').src = qrUrl;
            document.getElementById('descargar-qr').href = qrUrl;
        }

        // Cerrar sesi√≥n admin
        function cerrarSesion() {
            esAdmin = false;
            document.getElementById('clave-admin').value = '';
            
            // Restaurar tabs originales
            const navTabs = document.getElementById('nav-tabs');
            navTabs.innerHTML = `
                <button onclick="mostrarVista('formulario')" id="tab-formulario" class="flex-1 py-4 px-6 font-semibold transition-colors bg-purple-50 text-purple-700 border-b-2 border-purple-600">Formulario</button>
                <button onclick="mostrarVista('admin')" id="tab-admin" class="flex-1 py-4 px-6 font-semibold transition-colors text-gray-600 hover:bg-gray-50">Administrador</button>
            `;
            
            mostrarVista('formulario');
        }

        // Inicializar
        window.onload = function() {
            mostrarVista('formulario');
        };
    </script>
</body>
</html>
